<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SM Mobile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/c2e05c0cf1.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="../content/css/index.css">
    <link rel="stylesheet" href="../content/css/details.css">
    <link rel="stylesheet" href="../content/css/login.css">
    <link rel="stylesheet" href="../content/css/cart-so-luong.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="../content/js/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="../content/css/jquery-ui.min.css">
    <script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.min.js" type="text/javascript"></script>
    <script src="../content/js/cart-so-luong.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <!-- Bootstrap JavaScript -->
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../content/css/shopping-cart.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="shortcut icon" type="image/png" href="../public/images/modern-flat-mobile-icon-illustration-free-vector.jpg"/>
</head>
<body>
    <a href="javascript:void(0);" onclick="myLogin()"><div class="overlay-hide" id="overlay"></div></a>
    <div class="wrapper">

        <!-- <?php require "tai-khoan/dang-nhap-form.php";?> -->
        <header>
            <!-- <?php require "layout/header.php"; ?> -->
            <div class="top-header">
                <div class="inside">
                    <div class="top-header-content">
                    <a href="index.html">
                        <figure class="logo-ifan">
                            <img src="../content\images\products\LOGO-IFAN.png" alt="">
                        </figure>
                    </a>
                    <div class="top-header-right">
                        <div class="top-header-right-item">
                            <img src="../content\images\products\auto1-150x98.png" alt="">
                        </div>
                        <div class="top-header-right-item">
                            <p><i class="fas fa-phone-alt"></i> 19002121</p>
                        </div>
                        <div class="top-header-right-item">
                            <p><i class="fas fa-map-marker-alt"></i>  Địa Chỉ</p>
                        </div>
                        <div class="top-header-right-item">
                            <a href="giohang.html"><i class="fas fa-shopping-bag"></i></a>
                        </div>
                        <div class="top-header-right-item">
                            <a href="javascript:void(0);" onclick="myLogin()"><i class="fas fa-user"></i></a>
                        </div>
                    </div>
                </div>
                </div>
            </div>
            <script>
                function myLogin(){
                var y = document.getElementById("dang-nhap");
                if (y.className =="dang-nhap"){
                y.className +="-show";
                myOverlay();
                }else{
                y.className = "dang-nhap";
                myOverlay();
                }
              }
            </script>
            <!-- <?php require "layout/menu.php"; ?> -->
            <div id="navbar">
                <div class="menu" id="menu">
                    <div class="inside">
                        <ul id="list-category">
                            <li><a href="index.html"><i style="font-size: 24px" class="fab fa-apple"></i></a></li>
                            
                        </ul>
                    </div>
                </div>
            </div>
        </header>
        <!-- <?php require $VIEW_NAME;?> -->
        <div class="container">
            <div class="row">
                <div class="content-wrap col-md-12 col-sm-12 col-xs-12">
                    <!-- Begin Heading 2 -->
                    <div class="title-page">
                        <h2>Giỏ hàng</h2>
                    </div>
                    <!-- End Heading 2 -->
    
                    <!-- Cart Form -->
                    <div class="form">
                        <form class="cart-form">
                            <table class="cart-table">
                                <!-- Table Header -->
                                <thead>
                                    <tr>
                                        <th class="product-remove"></th>
                                        <th class="product-thumbnail"></th>
                                        <th class="product-name">Sản phẩm</th>
                                        <th class="product-price">Giá</th>
                                        <th class="product-quantity">Số lượng</th>
                                        <th class="product-subtotal">Tạm tính</th>
                                    </tr>
                                </thead>
                                <tbody id="list-cart">
                                    <!-- Begin Line 2 -->

                                    <!-- End Line 2 -->
    
                                    <!-- Begin Coupon, Update Cart -->
                                    </form>
                                    <!-- End Coupon, Update Cart -->
    
                                </tbody>
                                <!-- End Table Body -->
    
                            </table>
                        </form>
                <div class="thanh-toan">
                    <div class="dang-ky-thanh-toan">

                        <h2>Thông tin tài khoản</h2>
                        <div class="form-group-login">
                            <label for="">Họ và Tên</label><br>
                            <input  name="hoTen" value="" id="hoTen" type="text" class="form-input">
                        </div>
                        <div class="form-group-login">
                            <label for="">Email</label><br>
                            <input  name="email" value="" type="email" id="email" class="form-input">
                        </div>
                        <div class="form-group-login">
                            <label for="">Số Điện Thoại</label><br>
                            <input  name="sdt" value="" type="number" id="sdt" class="form-input">
                        </div>
                        <div class="form-group-login">
                            <label for="">Địa Chỉ</label><br>
                            <input name="diaChi" type="text" value="" id="diaChi" class="form-input">
                        </div>
                        <div class="form-group-login">
                            <label for="">Ghi chú</label><br>
                            <textarea name="ghiChu" class="form-input" id="ghiChu" cols="67" rows="4" placeholder="Nhập ghi chú ở đây"></textarea>
                        </div>
                        <input name="vai_tro" value="0" type="hidden">
                        <input name="kich_hoat" value="1" type="hidden">
                        <input name="mat_khau" value="" type="hidden">
                        <input name="ma_tk" value="" type="hidden">  
                    
                </div>
                        <div class="cart-collaterals">
                            <div class="cart_totals">
                                <table class="table1">
                                    <thead>
                                        <th class="th1" colspan="2">Cộng giỏ hàng</th>
                                    </thead>
                                    <tbody>
                                        <tr></tr>
                                        <th>Tạm tính</th>
                                        <td>
                                            <strong>
                                            <span id="total">
                                                0
                                            </span>
                                            </strong>
                                        </td>
    
    
                                        <tr></tr>
                                        <th>Giao hàng</th>
                                        <td>
                                            <strong>
                                                <span>
                                                    30000
                                                    <span>VNĐ</span>
                                                </span>
                                            </strong>
                                        </td>
    
                                        <tr></tr>
                                        <th>Tổng</th>
                                        <td>
                                            <strong>
                                                <span id="totalFull">
                                                   0
                                                    <span>VNĐ</span>
                                                </span>
                                            </strong>
                                        </td>
                                    </tbody>
                                    
                                    <tfoot>
                                        <!-- Thanh _toán -->
                                        <th colspan="2">
                                            <div>
                                                <input type="hidden" name="tong_tien" value="<?php echo $thanh_toan;?>">
                                                <button id="btn_order" class="btn-login" style="width: 100%;" name="btn_insert">Tiến hành đặt hàng</button>
                                            </div>
                                        </th>
                                    </tfoot>
                                    
                                  
                                </table>
                            </div>
                        </div>
                        <!--End Cart Total -->
    
                        </div>
                    </div>
                    <!-- End Cart Form -->
    
                </div>
            </div>
        </div>
        <!-- <?php require "layout/footer.php";?> -->
        <footer id="footer">
            <div id="top-footer">
                <div class="row">
                    <div class="col">
                        <h4>Thông tin </h4>
                        <div class="contact">
                            <ul>
                                <li> <a href="#">Giới thiệu </a></li>
                                <li> <a href="#">Khuyến mại </a></li>
                                <li> <a href="#">Tuyển dụng </a></li>
                                <li>
                                    <a href="#">Chương trình liên kết</a>
                                </li>
                                <li> <a href="#">Hệ thống của hàng </a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col">
                        <h4>Chính sách </h4>
                        <div class="contact">
                            <ul>
                                <li> <a href="#">Chính sách đổi trả </a></li>
                                <li> <a href="#">Chính sách bảo mật </a></li>
                                <li> <a href="#">Chính sách hoạt động chung </a></li>
                                <li> <a href="#">Chính sách trả góp</a></li>
                                <li> <a href="#">Chính sách bảo hành </a></li>
                                <li> <a href="#">Chính sách Ship – COD </a></li>
                                <li><a href="#">Hướng dẫn Check IMEI </a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col">
                        <h4>Liện hệ </h4>
                        <div class="contact">
                            <ul>
                                <li> <a href="#">Gọi tư vấn mua hàng: <b> 1900.6626</b></a></li>
                                <li> <a href="#">Gọi khiếu nại: <b> 0886.308.688 </b></a></li>
                                <li> <a href="#">Dành cho Doanh nghiệp & Đối tác:<b> 0972.927.907 </b></a></li>
                                <li> <a href="#">Thiết bị của chúng tôi</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col">
                      <div class="contact_inf">
                       <div class="contact__img">
                            <img src="<?=$CONTENT_URL?>/images/products/tich.jpg" alt="">
                       </div>
                       <div class="contact__visa">
                             <img src="<?=$CONTENT_URL?>/images/products/visa.jpg" alt="">
                       </div>
                       <div class="form">
                           <div class="from_Register">
                            <p>Đăng ký nhận tin từ iFanStore</p>  
                           </div>
                            <div class="from_p">
                                <p> Nhận thông tin sản phẩm mới và chương trình khuyến mại của iFanStore</p>
                            </div>
                       </div>
                      </div>
                        <form action="" class="emailform">
                            <input id="input1" type="text" placeholder="Vui lòng nhập địa chỉ Email"><button id="button1" type="submit"><i class="fas fa-paper-plane"></i>&nbsp;Đăng ký</button>
                        </form>
                    </div>
                </div>
            </div>
            <div id="copyrigt">
                <p>© 2022 Công ty CP HHD Việt Nam<br>
    
                    Giấy chứng nhận ĐKDN số 0107465657 do Sở kế hoạch và đầu tư thành phố Hà Nội cấp ngày 08 tháng 06 năm 2021. Địa chỉ: Số 428, Phường Hòa An, Quận Cẩm Lệ, Thành phố Đà Nẵng, Việt Nam<br>
                    Điện thoại: 0247.305.9999.<br>
                    Email: lienhe@iFanStore.com.<br>
                    Đại diện pháp luật: NGUYỄN QUANG HIẾU</p><br>
            </div>
        </footer>
    </div>
    <script>
        //Get categorary
        var url="http://localhost:3000/category";
        fetch(url).then(data=> data.json())
        .then(category=>{
            cat_arr=category.map(cat=>{
                return `<li><a href="listByCat.html?id=${cat.id}">${cat.name}</a></li>`
            })
            cat_arr.push(`<li><a href="">Phụ kiện</a></li>
                            <li><a href="">Dịch vụ</a></li>
                            <li><a href="">Khuyến mại</a></li>
                            <li><a href="">Giới thiệu</a></li>
                            <li>
                                <form action="<?=$SITE_URL?>/san-pham/liet-ke.php">
                                    <input class="input-search" type="text" placeholder="Bạn muốn mua gì?" name="keyword">
                                    <button class="submit-search" type="submit"><i class="fa fa-search"></i></button>
                                </form>
            
                            </li>`);
            document.querySelector('#list-category').innerHTML+=cat_arr;
            
        });
    </script>
    <script>
    function myOverlay(){
    var y = document.getElementById("overlay");
    if (y.className =="overlay-hide"){
    y.className ="overlay";
    }else{
    y.className = "overlay-hide";
    }
    }
    
    </script>
    <script>
        window.onscroll = function() {myFunction()};

        var navbar = document.getElementById("navbar");
        var sticky = navbar.offsetTop;

        function myFunction() {
        if (window.pageYOffset >= sticky) {
            navbar.classList.add("sticky")
        } else {
            navbar.classList.remove("sticky");
        }
    }
    </script>
    <script src="../public/js/jquery-3.6.0.min.js"></script>
    <script>
        var cart=JSON.parse(localStorage.getItem("cart"));
        var total=0;
        if(cart)cart.forEach((sp,index)=>{
            total+=sp.price*sp.quantity;
            document.querySelector("#list-cart").innerHTML+=`
            <tr>
                <input type="hidden" name="" id="" value="09">
                <td class="product-remove">
                            <i onclick="xoaCart(${sp.id})" name="delete-cart"class="fas fa-times"></i>
                </td>

                <td class="product-thumbnail">
                    
                    <img id="img1" src="../public/images/products/${sp.image}" alt="">
                </td>

                <td style="text-align: left;" class="product-name">
                        <a class="remove" href="detail.html?id=${sp.id}">${sp.name}</a>
                </td>

                <td class="product-price">
                    <span>
                        ${sp.price}
                        <span>VNĐ</span>
                        
                    </span>
                </td>
                
                <td class="product-quantity">
                    <div class="buttons_added">
                        <input class="minus is-form" type="button" value="-" onclick="tru()">
                        <input style="width:50px;"  aria-label="quantity"  class="input-qty" min="1" name="so_luong" id="soLuong" type="number" value="${sp.quantity}"
                        onkeyup="doiSoLuong(${sp.price}, this.value, ${index})">
                        <input class="plus is-form" type="button" value="+" onclick="cong()">
                    </div>
                </td>

                <td class="product-subtotal">
                    <span style="font-size: 14px; font-weight: bold;">
                        <p class="tien" id="tongSp">${sp.price*sp.quantity}<span>VNĐ</span></p>
                    </span>
                </td>
            </tr>
            `
        });
        strTotal=document.getElementById('total');
        strTotal.innerText=total +" VNĐ";
        var strTotalFull=document.getElementById('totalFull');
        strTotalFull.innerText=(total+30000) +" VNĐ";
        url_order="http://localhost:3000/order";
        urlOrderDetail="http://localhost:3000/orderDetail";
        
        function doiSoLuong(gia,soLuong,i){
            tien=gia*soLuong;
            document.getElementsByClassName("tien")[i].innerText=tien +"VNĐ";
            cart[i].quantity = soLuong;
            localStorage.setItem("cart", JSON.stringify(cart));
            doiTotal();
        }
        function doiTotal(){
            arrTien=document.getElementsByClassName("tien");
            strTotal=0;
            for(let t of arrTien){
                strTotal+=parseInt(t.innerText);
            }
            strTotalFull=strTotal+30000;
            document.getElementById('total').innerText=strTotal+" VNĐ";
            document.getElementById('totalFull').innerText=(strTotal+30000) +" VNĐ";
        }
        
        function xoaCart(id) {
            let cart = localStorage.getItem("cart");
            if (cart == null) {
                cart = [];
            } else {
                // Chuyển cart về file Json
                cart = JSON.parse(cart);
            }
            let existed = cart.map(o => o.id).indexOf(id);
            cart = cart.filter(item => item !== cart[existed]);
            localStorage.setItem("cart", JSON.stringify(cart));
            window.location.href="giohang.html";
        }

        
        function InsertOrderDetail(order_id) {
        var listCart = JSON.parse(localStorage.getItem("cart"));
        listCart.forEach(sp =>{
            
            let objSP={
                "order_id": order_id,
                "product_id": sp.id,
                "product_name": sp.name,
                "quantity": sp.quantity,
                "unti_price": sp.price*sp.quantity
            };
           
            fetch(`${urlOrderDetail}`,{
                method : 'POST',
                headers: {
                    "Content-Type" : "application/json"
                },
                body : JSON.stringify(objSP)
            })
            .then(res => res.json())
            .then(data => {
                alert("OK");
            })
        })
        alert("Bạn đã đặt hàng thành công. Sẽ có Nhân viên liện hệ xác nhận đơn hàng! Cảm ơn sự tin dùng của bạn");
        localStorage.removeItem("cart");
        
    }
        document.getElementById('btn_order').onclick=function(){
            var hoTen=document.getElementById('hoTen').value;
            var email=document.getElementById('email').value;
            var sdt=document.getElementById('sdt').value;
            var diaChi=document.getElementById('diaChi').value;
            var ghiChu=document.getElementById('ghiChu').value;

    if(hoTen === "" || email === "" || sdt === "" || diaChi === "" ){
        alert('QUÝ KHÁCH VUI LÒNG ĐIỀN ĐẦY ĐỦ THÔNG TIN ĐỂ ĐẶT HÀNG !')
    }else{
            var order={
                "fullname": hoTen,
                "address": diaChi,
                "email": email,
                "phone": sdt,
                "status": 1,
                "total": strTotalFull,
                "note": ghiChu,
                "date": new Date().toISOString().slice(0,10)
                };
            fetch(`${url_order}`,{
                method : 'POST',
                headers: {
                    "Content-Type" : "application/json"
                },
                body : JSON.stringify(order)
            })
            .then(res => res.json())
            .then(data => {
                
                InsertOrderDetail(data.id);

            })
            alert('Đang Xử lý');
            
        }
    }
        
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
</body>